---
title: "Installing and Configuring Drivers"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Installing and Configuring Drivers}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette outlines how to install common ODBC drivers and configure them with a driver manager.

## Installation

For Unix and MacOS, ODBC drivers should be compiled against [unixODBC](https://www.unixodbc.org/). Drivers compiled against [iODBC](https://www.iodbc.org/) _may_ also work, but are not fully supported.

After installation of the driver manager and driver, you will have to register the driver in a [odbcinst.ini](#dsn-configuration-files) file for it to appear in `odbc::odbcListDrivers()`.

### Windows

Windows is bundled with ODBC libraries. However, drivers for each database need to be installed separately. Windows ODBC drivers typically include an installer that needs to be run and will install the driver to the proper locations.

### MacOS

[homebrew](https://brew.sh/) can be used to easily install database drivers on MacOS.

The UnixODBC driver manager is required for all databases:

```shell
## Install the unixODBC library
brew install unixodbc
```

Most common database drivers can be installed with homebrew. Some drivers are only available from the database vendor.

```shell
## Microsoft SQL Server ODBC Drivers (Recommended)
brew tap microsoft/mssql-release https://github.com/Microsoft/homebrew-mssql-release
brew update
brew install msodbcsql17 mssql-tools

## SQL Server ODBC Drivers (Free TDS)
brew install freetds

## PostgreSQL ODBC ODBC Drivers
brew install psqlodbc

## MySQL ODBC Drivers (and database)
brew install mysql

## SQLite ODBC Drivers
brew install sqliteodbc
```

Some driver installations will not automatically configure the driver with the driver manager. See the ["Connecting to a Database"](#connecting) section below to learn more about configuring drivers and data sources.

### Linux - Debian / Ubuntu

[apt-get](https://wiki.debian.org/Apt) can be used to easily install database
drivers on Linux distributions which support it, such as Debian and Ubuntu.

The UnixODBC driver manager is required for all databases:

```shell
## Install the unixODBC library
apt-get install unixodbc unixodbc-dev
```

For SQL Server on Linux it is recommended you use the [Microsoft Drivers](https://learn.microsoft.com/en-us/sql/connect/odbc/linux-mac/installing-the-microsoft-odbc-driver-for-sql-server?view=sql-server-ver15#ubuntu18). The code below will install some common drivers:

```shell
## SQL Server ODBC Drivers (Free TDS)
apt-get install tdsodbc

## PostgreSQL ODBC ODBC Drivers
apt-get install odbc-postgresql

## MySQL ODBC Drivers
apt-get install libmyodbc

## SQLite ODBC Drivers
apt-get install libsqliteodbc
```

## Connecting to a Database {#connecting}

The most convenient way to connect to a database is to configuring a Data Source
Name (DSN).^[To learn more about passing connection strings directly, see the `dbConnect()` documentation.] Properly configuring a DSN will mean that many arguments are set by default for you whenever you connect to that DSN. For example, without a DSN configured, the code to connect to `PostgreSQL` may look something like:

```{r, include = FALSE}
Sys.setenv(PASSWORD = "password")
```

```r
library(DBI)
con <- 
  dbConnect(
    odbc::odbc(),
    driver = "/opt/homebrew/Cellar/psqlodbc/16.00.0000/lib/psqlodbcw.so",
    database = "test_db",
    uid = "postgres",
    pwd = Sys.getenv("PASSWORD"),
    host = "localhost",
    port = 5432
  )
```

With a DSN configured, that code could simplify to:

```r
con <- dbConnect(odbc::odbc(), "PostgreSQL")
```

The process to configure a DSN depends on your operating system. 
To test whether odbc detects your DSN configuration, use the `odbcListDataSources()` and `odbcListDrivers()` functions.

### Windows

The [ODBC Data Source Administrator](https://learn.microsoft.com/en-us/sql/odbc/admin/odbc-data-source-administrator?view=sql-server-ver15) application is used to manage ODBC data sources on Windows.

### MacOS / Linux

On MacOS and Linux there are two separate text files that need to be edited. UnixODBC includes a command line executable `odbcinst` which can be used to query and modify the DSN files. However these are plain text files you can also edit by hand if desired; run `odbcinst -j` to locate the files on your system.

There are two different files used to configure a connection:

- `odbcinst.ini` configures the _driver name_.
- `odbc.ini` configures the _data source name_, which often references a driver name, too.

The DSN configuration files can be defined globally for all users of the
system, often at `/etc/odbc.ini`, `/opt/local/etc/odbc.ini` or `/opt/homebrew/etc/odbc.ini`, the exact location depends on what option was used when compiling unixODBC. `odbcinst -j` can be used to find the exact location. Alternatively the `ODBCSYSINI` environment variable can be used to specify the location of the configuration files, e.g. `ODBCSYSINI=~/ODBC`.

A local DSN file can also be used with the files `~/.odbc.ini` and `~/.odbcinst.ini`.

Some users report issues with configuring data sources with aarch64 architecture chips (e.g. M1 and M2). If ODBC has trouble locating your system data source names, you may need to override the default location where odbc looks for your configuration files. You can tell odbc where to find your configuration files using `.Renviron` files. 

1. Create or open the `~/.Renviron` file. To do so using R, run `usethis::edit_r_environ()`.
2. Add `ODBCSYSINI=/opt/homebrew/etc` to your `~/.Renviron` file and
   save your changes.
3. Restart any open R sessions before connecting to a database.

#### odbcinst.ini

`odbcinst.ini` contains driver information, particularly the _driver name_ and the location of the installed driver file. Multiple drivers can be specified in the same file. For example:

```ini
[PostgreSQL Driver]
Driver          = /usr/local/lib/psqlodbcw.so

[SQLite Driver]
Driver          = /usr/local/lib/libsqlite3odbc.dylib
```

On MacOS aarch64 machines, drivers installed via homebrew are in a different location. Those might look something like:

```ini
[PostgreSQL Driver]
Driver          = /opt/homebrew/lib/psqlodbcw.so

[SQLite Driver]
Driver          = /opt/homebrew/lib/libsqlite3odbc.dylib
```

#### odbc.ini

`odbc.ini` contains connection information, particularly the username, password, database and host information. The `Driver` value corresponds to the _driver name_ defined in `odbcinst.ini`. For example:

```ini
[PostgreSQL]
Driver              = PostgreSQL Driver
Database            = test_db
Servername          = localhost
UserName            = postgres
Password            = password
Port                = 5432

[SQLite]
Driver              = SQLite Driver
Database            = /tmp/testing
```

See also: [unixODBC without the GUI](https://www.unixodbc.org/odbcinst.html) for more information and examples.
